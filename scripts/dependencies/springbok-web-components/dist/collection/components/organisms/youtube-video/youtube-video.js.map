{"version":3,"file":"youtube-video.js","sourceRoot":"","sources":["../../../../src/components/organisms/youtube-video/youtube-video.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { isEmpty } from '@springbokagency/stencil-base';\nimport { playerApi } from './youtube-video.data';\nimport { PlayerState, YoutubeControlUpdateEvent } from './youtube-video.types';\nimport { YoutubeControlClickEvent } from '../../molecules/youtube-control/youtube-control.types';\n\ndeclare global {\n  interface Window {\n    onYouTubeIframeAPIReady: () => void;\n    onYouTubePlayerAPIReady: () => void;\n  }\n}\n\n/**\n * The youtube video component.\n */\n@Component({\n  tag: 'bs-youtube-video',\n  styleUrl: 'youtube-video.scss',\n  shadow: true,\n})\nexport class BsYoutubeVideo {\n  private player: YT.Player;\n\n  private progressBarInterval: NodeJS.Timeout;\n\n  private videoElementRef: HTMLDivElement | HTMLIFrameElement;\n\n  private overlayRef: HTMLBsDarkOverlayElement;\n\n  /** States */\n  @State() playerState: PlayerState = null;\n\n  @State() currentTime: number;\n\n  /** Props */\n\n  /**\n   * Should the player be loaded inline?\n   */\n  @Prop() inline?: boolean = false;\n\n  /**\n   * The youtube video ID.\n   */\n  @Prop() videoId!: string;\n\n  /**\n   * Should the video be muted initially?\n   */\n  @Prop() mute?: boolean = false;\n\n  @Watch('mute')\n  handleMute(mute: boolean) {\n    if (mute) {\n      this.player.mute();\n    } else {\n      this.player.unMute();\n    }\n  }\n\n  /** Events */\n  /** Event for all user actions on the controller. */\n  @Event() bsYoutubeControllerUpdate: EventEmitter<YoutubeControlUpdateEvent>;\n\n  /** Listeners */\n  @Listen('bsYoutubeControllerClick', { target: 'window' })\n  bsYoutubeControllerClickHandler(e: CustomEvent<YoutubeControlClickEvent>) {\n    if (this.videoId === e.detail.id) {\n      switch (e.detail.action) {\n        case 'play':\n          if (e.detail.value === 1) {\n            this.player.playVideo();\n          } else {\n            this.player.pauseVideo();\n          }\n\n          break;\n        case 'mute':\n          this.mute = !this.mute;\n          break;\n\n        case 'fullscreen': {\n          this.player.getIframe().requestFullscreen();\n          break;\n        }\n\n        case 'progress-bar-input':\n          this.player.seekTo((e.detail.value / 100) * this.player.getDuration(), true);\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  @Listen('bsYoutubeAPIReady', { target: 'window' })\n  bsYoutubeAPIReadyHandler() {\n    this.createPlayer();\n  }\n\n  /** methods */\n\n  private onPlayerReady = (e: any) => {\n    this.updateYoutubeController();\n    this.onPlayerStateChange(e);\n  };\n\n  private onPlayerStateChange = (e: YT.OnStateChangeEvent) => {\n    this.playerState = e.target.getPlayerState();\n\n    if (this.playerState === PlayerState.PLAYING) {\n      this.progressBarInterval = setInterval(this.calculateTime, 100);\n    } else if (this.playerState === PlayerState.UNSTARTED) {\n      this.player.playVideo();\n    } else if (this.playerState === PlayerState.ENDED) {\n      this.updateYoutubeController();\n      this.overlayRef?.closeOverlay();\n    } else {\n      this.calculateTime();\n      clearInterval(this.progressBarInterval);\n    }\n\n    this.updateYoutubeController();\n  };\n\n  private calculateTime = () => {\n    this.currentTime = (this.player.getCurrentTime() / this.player.getDuration()) * 100;\n    this.updateYoutubeController();\n  };\n\n  private updateYoutubeController = () => {\n    const { mute, playerState, currentTime } = this;\n\n    this.bsYoutubeControllerUpdate.emit({ id: this.videoId, mute, playerState, currentTime });\n  };\n\n  private isIosOrSafari = (): boolean => {\n    const { userAgent } = navigator;\n    const chromeAgent = userAgent.indexOf('Chrome') > -1;\n    let safariAgent = userAgent.indexOf('Safari') > -1;\n\n    if (chromeAgent && safariAgent) safariAgent = false;\n    // chrome on mac has match for both Chrome and Safari.\n\n    const match = !isEmpty(userAgent.match(/(iPad|iPhone|iPod)/g)) || safariAgent;\n\n    this.mute = match ? true : this.mute;\n\n    return match;\n  };\n\n  private createPlayer = () => {\n    this.player = new YT.Player(this.videoElementRef, {\n      width: '640',\n      height: '360',\n      videoId: this.videoId,\n      host: 'https://www.youtube.com',\n      playerVars: {\n        playsinline: 1,\n        controls: 0,\n        rel: 0,\n        mute: this.isIosOrSafari() ? 1 : +this.mute,\n        // mute by default on IOS devices or safari for otherwise the autoplay will not work.\n        autoplay: 1,\n      },\n      events: {\n        onReady: this.onPlayerReady,\n        onStateChange: this.onPlayerStateChange,\n      },\n    });\n  };\n\n  /** lifecycle hooks */\n  componentDidLoad() {\n    const tag = document.createElement('script');\n    const scripts = document.getElementsByTagName('script') as HTMLCollectionOf<HTMLScriptElement>;\n\n    tag.src = playerApi;\n\n    for (let i = 0; i < scripts.length; i += 1) {\n      if (scripts[i].src === playerApi) {\n        this.createPlayer();\n\n        return;\n      }\n    }\n\n    scripts[0].parentNode.insertBefore(tag, scripts[0]);\n\n    this.mute = this.isIosOrSafari() ? true : this.mute;\n  }\n\n  disconnectedCallback() {\n    this.player.destroy();\n  }\n\n  render() {\n    if (this.inline) {\n      return (\n        <div slot=\"media\" class=\"youtube-video\">\n          <div\n            ref={(el) => {\n              this.videoElementRef = el;\n            }}\n            class=\"youtube-embed\"\n            tabIndex={-1}\n          />\n        </div>\n      );\n    }\n\n    return (\n      <Host>\n        <bs-dark-overlay\n          class=\"media\"\n          ref={(el) => {\n            this.overlayRef = el;\n          }}\n        >\n          <div slot=\"media\" class=\"youtube-video\">\n            <div\n              ref={(el) => {\n                this.videoElementRef = el;\n              }}\n              class=\"youtube-embed\"\n              tabIndex={-1}\n            ></div>\n          </div>\n          <div slot=\"controller\" class=\"media-control\">\n            <bs-youtube-control mute={this.mute} videoId={this.videoId} />\n          </div>\n        </bs-dark-overlay>\n      </Host>\n    );\n  }\n}\n"]}