{"version":3,"file":"form-container.js","sourceRoot":"","sources":["../../../../src/components/organisms/form-container/form-container.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, State, Element, Listen, Prop } from '@stencil/core';\nimport { deepQuerySelectorAll } from '../../../utils/deepQuerySelectorAll';\n\n/**\n * The form container component.\n */\n@Component({\n  tag: 'bs-form-container',\n  styleUrl: 'form-container.scss',\n  shadow: false,\n})\nexport class BsFormContainer {\n  private allFields: HTMLBsFormFieldElement[];\n\n  private acceptedRequestStatus = [200, 201];\n\n  @Element() hostElement: HTMLBsFormContainerElement;\n\n  /**\n   * State\n   */\n\n  @State() formHasErrors: boolean = false;\n\n  @State() isFormSending: boolean = false;\n\n  @State() submitHasFailed: boolean = false;\n\n  /**\n   * Props\n   */\n\n  /**\n   * The endpoint for the submit request.\n   */\n\n  @Prop() action: string;\n\n  /**\n   * The recaptcha Public site key\n   */\n  @Prop() recaptchaSiteKey: string;\n\n  /**\n   * Message to inform the user there are issues with the filled in values.\n   */\n\n  @Prop() invalidFormMessage: string;\n\n  /**\n   * Message to inform the usere something went wrong while submitting the form.\n   */\n\n  @Prop() submitErrorMessage: string;\n\n  /**\n   * The page the user is redirected to in case of a successfull submit.\n   */\n\n  @Prop() successRedirect: string;\n\n  /**\n   * Events\n   */\n\n  @Listen('bsButtonClick')\n  async onBsButtonClickHandler(e: CustomEvent) {\n    if (e.detail.type === 'submit') {\n      this.formHasErrors = false;\n      this.submitHasFailed = false;\n      this.validateForm().then(() => {\n        if (this.isFormValid()) {\n          this.isFormSending = true;\n\n          this.submitRequest();\n        }\n      });\n    }\n  }\n\n  /**\n   * Methods\n   */\n\n  private async validateForm() {\n    this.formHasErrors = false;\n    await Promise.all(this.allFields.map((field) => field.validate()));\n  }\n\n  private isFormValid() {\n    this.formHasErrors = this.allFields.map((field) => field.invalid).includes(true);\n\n    return !this.formHasErrors;\n  }\n\n  private getData(token: string) {\n    const formData = {\n      responseToken: token,\n    };\n\n    this.allFields.forEach((field) => {\n      formData[field.name] = field.value;\n    });\n\n    return formData;\n  }\n\n  private async submitRequest() {\n    grecaptcha.ready(() => {\n      grecaptcha\n        .execute(this.recaptchaSiteKey, { action: 'submit' })\n        .then((token) => this.submitRequestWithToken(token));\n    });\n  }\n\n  private async submitRequestWithToken(token: string) {\n    try {\n      const response = await fetch(this.action, {\n        method: 'POST',\n        body: JSON.stringify(this.getData(token)),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      this.isFormSending = false;\n\n      if (this.acceptedRequestStatus.includes(response.status)) {\n        window.location.href = this.successRedirect;\n      } else {\n        this.submitHasFailed = true;\n      }\n    } catch {\n      this.isFormSending = false;\n      this.submitHasFailed = true;\n    }\n  }\n\n  /**\n   * Lifecycle hooks\n   */\n\n  componentDidLoad() {\n    this.allFields = deepQuerySelectorAll(\n      'bs-form-field',\n      this.hostElement\n    ) as HTMLBsFormFieldElement[];\n  }\n\n  /**\n   * Render\n   */\n\n  render() {\n    return (\n      <Host>\n        <script\n          src={`https://www.google.com/recaptcha/api.js?render=${this.recaptchaSiteKey}`}\n        ></script>\n        <form class=\"form-container\" action={this.action} method=\"dialog\">\n          <slot />\n          {this.formHasErrors && <p class=\"form-error\">{this.invalidFormMessage}&nbsp;</p>}\n          {this.submitHasFailed && <p class=\"form-error\">{this.submitErrorMessage}&nbsp;</p>}\n        </form>\n      </Host>\n    );\n  }\n}\n"]}